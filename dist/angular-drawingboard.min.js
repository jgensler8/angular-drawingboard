/* angular-drawingboard v0.1.0 - https://github.com/Leimi/drawingboard.js
* Copyright (c) 2014 Jeffrey Gensler
* Licensed MIT */
!function(){angular.module("ng-drawingboard",[]).directive("ngDrawingboard",[function(){var a={toDataURL:function(a,b){return a.toDataURL(b)},saveStorage:function(a,b){},clearStorage:function(){},draw:function(a,b,c,d,e,f,g,h,i){a.beginPath(),a.moveTo(h,i),a.quadraticCurveTo(b,c,d,e),a.stroke()},fill:function(){},clear:function(a){a.clearRect(0,0,a.canvas.width,a.canvas.width)},_getInputCoords:function(a,b){a=a.originalEvent?a.originalEvent:a;var c,d;return a.touches&&1==a.touches.length?(c=a.touches[0].pageX,d=a.touches[0].pageY):(c=a.pageX,d=a.pageY),{x:c-b.canvas.offsetLeft,y:d-b.canvas.offsetTop}},_getMidCoords:function(a,b,c,d){return{x:a+c>>1,y:b+d>>1}},_getStorage:function(){return!this.opts.webStorage||"session"!==this.opts.webStorage&&"local"!==this.opts.webStorage?!1:this.opts.webStorage+"Storage"}};return{template:"<canvas />",transclude:!0,restrict:"E",scope:{options:"=options",remote:"=remote"},link:function(b,c){b.remote||(b.remote={}),b.options||(b.options={}),b.drawingMode="pencil",b.canvas=c[0].firstChild,b.context=b.canvas.getContext("2d"),b.oldMidX=0,b.oldMidY=0,b.oldX=0,b.oldY=0,b.remote.toDataURL=function(c){return a.toDataURL(b.canvas,c)},b.remote.clear=function(){return a.clear(b.context)},b.remote.clearStorage=function(){},c.bind(b.drawingMode,b.remote.drawingMode),c.bind("mousedown touchstart",function(a){b.drawing=!0,"pencil"===b.drawingMode&&b.remote.on.startDraw&&b.remote.on.startDraw(a)}),c.bind("mouseup touchend",function(c){b.drawing=!1,b.options.webStorage&&a.saveStorage(b.canvas,b.options.webStorage),"pencil"===b.drawingMode&&b.remote.on.endDraw&&b.remote.on.endDraw(c)}),c.bind("mousemove touchmove",function(c){var d=a._getInputCoords(c,b.context),e=a._getMidCoords(b.oldX,b.oldY,d.x,d.y);"pencil"===b.drawingMode&&b.drawing&&(a.draw(b.context,b.oldX,b.oldY,b.oldMidX,b.oldMidY,d.x,d.y,e.x,e.y),b.remote.on.drawing&&b.remote.on.drawing(c)),b.oldX=d.x,b.oldY=d.y,b.oldMidX=e.x,b.oldMidY=e.y}),c.bind("mouseleave",function(a){b.drawing=!1,"pencil"===b.drawingMode&&b.remote.on.endDraw&&b.remote.on.endDraw(a)})}}}])}();